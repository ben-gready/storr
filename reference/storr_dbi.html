<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>DBI storr driver — storr_dbi • storr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">storr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/storr.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/external.html">external</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/richfitz/storr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>DBI storr driver</h1>
    </div>

    
    <p>Object cache driver using the "DBI" package interface for storage.
This means that storr can work for any supported "DBI" driver
(though practically this works only for SQLite and Postgres until
some MySQL dialect translation is done).  To connect, you must
provide the <em>driver</em> object (e.g., <code><a href='http://www.rdocumentation.org/packages/RSQLite/topics/SQLite'>RSQLite::SQLite()</a></code>,
<code><a href='http://www.rdocumentation.org/packages/RPostgreSQL/topics/PostgreSQL'>RPostgreSQL::PostgreSQL()</a></code>, <code><a href='http://www.rdocumentation.org/packages/RPostgres/topics/Postgres'>RPostgres::Postgres()</a></code> as
the first argument,</p>
    

    <pre class="usage"><span class='fu'>storr_dbi</span>(<span class='no'>tbl_data</span>, <span class='no'>tbl_keys</span>, <span class='no'>con</span>, <span class='kw'>args</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>binary</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>hash_algorithm</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>default_namespace</span> <span class='kw'>=</span> <span class='st'>"objects"</span>)

<span class='fu'>driver_dbi</span>(<span class='no'>tbl_data</span>, <span class='no'>tbl_keys</span>, <span class='no'>con</span>, <span class='kw'>args</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>binary</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>hash_algorithm</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>tbl_data</th>
      <td><p>Name for the table that maps hashes to values</p></td>
    </tr>
    <tr>
      <th>tbl_keys</th>
      <td><p>Name for the table that maps keys to hashes</p></td>
    </tr>
    <tr>
      <th>con</th>
      <td><p>Either A DBI connection or a DBI driver (see example)</p></td>
    </tr>
    <tr>
      <th>args</th>
      <td><p>Arguments to pass, along with the driver, to
<code><a href='http://www.rdocumentation.org/packages/DBI/topics/dbConnect'>DBI::dbConnect</a></code> if <code>con</code> is a driver.</p></td>
    </tr>
    <tr>
      <th>binary</th>
      <td><p>Optional logical indicating if the values should be
stored in binary.  If possible, this is both (potentially
faster) and more accurate.  However, at present it is supported
only under very recent DBI and RSQLite packages, and for no
other DBI drivers, and is not actually any faster.  If not given
(i.e., <code>NULL</code>), then binary storage will be used where
possible when creating new tables, and where tables exist, we
use whatever was used in the existing tables.</p></td>
    </tr>
    <tr>
      <th>hash_algorithm</th>
      <td><p>Name of the hash algorithm to use.  Possible
values are "md5", "sha1", and others supported by
<code>digest</code>.  If not given, then we will default to
"md5".</p></td>
    </tr>
    <tr>
      <th>default_namespace</th>
      <td><p>Default namespace (see
<code><a href='storr.html'>storr</a></code>).</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Because the DBI package
specifies a uniform interface for the using DBI compliant
databases, you need only to provide a connection object.  storr
does not do anything to help create the connection object itself.</p>
<p>The DBI storr driver works by using two tables; one mapping keys
to hashes, and one mapping hashes to values.  Two table names need
to be provided here; they must be different and they should be
treated as opaque (don't use them for anything else - reading or
writing).  Apart from that the names do not matter.</p>
<p>Because of treatment of binary data by the underlying DBI drivers,
binary serialistion is not any faster (and might be slightly
slower than) string serialisation, in contrast with my experience
with other backends.</p>
<p>storr uses DBI's "prepared query" approach to safely interpolate
keys, namespaces and values into the database - this should allow
odd characters without throwing SQL syntax errors.  Table names
can't be interpolated in the same way - these storr simply quotes,
but validates beforehand to ensure that <code>tbl_data</code> and
<code>tbl_keys</code> do not contain quotes.</p>
<p>Be aware that <code>$destroy()</code> will close the connection to the
database.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fu'>requireNamespace</span>(<span class='st'>"RSQLite"</span>, <span class='kw'>quietly</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)) {
  <span class='no'>st</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>storr</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/storr/topics/storr_dbi'>storr_dbi</a></span>(<span class='st'>"tblData"</span>, <span class='st'>"tblKeys"</span>, <span class='kw pkg'>RSQLite</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/RSQLite/topics/SQLite'>SQLite</a></span>(),
                         <span class='st'>":memory:"</span>)

  <span class='co'># Set some data:</span>
  <span class='no'>st</span>$<span class='fu'>set</span>(<span class='st'>"foo"</span>, <span class='fu'>runif</span>(<span class='fl'>10</span>))
  <span class='no'>st</span>$<span class='fu'>list</span>()

  <span class='co'># And retrieve the data:</span>
  <span class='no'>st</span>$<span class='fu'>get</span>(<span class='st'>"foo"</span>)

  <span class='co'># These are the data tables; treat these as read only</span>
  <span class='kw pkg'>DBI</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/DBI/topics/dbListTables'>dbListTables</a></span>(<span class='no'>st</span>$<span class='no'>driver</span>$<span class='no'>con</span>)

  <span class='co'># With recent RSQLite you'll get binary storage here:</span>
  <span class='no'>st</span>$<span class='no'>driver</span>$<span class='no'>binary</span>

  <span class='co'># The entire storr part of the database can be removed using</span>
  <span class='co'># "destroy"; this will also close the connection to the database</span>
  <span class='no'>st</span>$<span class='fu'>destroy</span>()

  <span class='co'># If you have a connection you want to reuse (which will the the</span>
  <span class='co'># case if you are using an in-memory SQLite database for</span>
  <span class='co'># multiple things within an application) it may be useful to</span>
  <span class='co'># pass the connection object instead of the driver:</span>
  <span class='no'>con</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>DBI</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/DBI/topics/dbConnect'>dbConnect</a></span>(<span class='kw pkg'>RSQLite</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/RSQLite/topics/SQLite'>SQLite</a></span>(), <span class='st'>":memory:"</span>)
  <span class='no'>st</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>storr</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/storr/topics/storr_dbi'>storr_dbi</a></span>(<span class='st'>"tblData"</span>, <span class='st'>"tblKeys"</span>, <span class='no'>con</span>)
  <span class='no'>st</span>$<span class='fu'>set</span>(<span class='st'>"foo"</span>, <span class='fu'>runif</span>(<span class='fl'>10</span>))

  <span class='co'># You can then connect a different storr to the same underlying</span>
  <span class='co'># storage</span>
  <span class='no'>st2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>storr</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/storr/topics/storr_dbi'>storr_dbi</a></span>(<span class='st'>"tblData"</span>, <span class='st'>"tblKeys"</span>, <span class='no'>con</span>)
  <span class='no'>st2</span>$<span class='fu'>get</span>(<span class='st'>"foo"</span>)
}</div><div class='output co'>#&gt;  [1] 0.87460066 0.17494063 0.03424133 0.32038573 0.40232824 0.19566983
#&gt;  [7] 0.40353812 0.06366146 0.38870131 0.97554784</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Rich FitzJohn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
